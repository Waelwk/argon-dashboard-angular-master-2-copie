
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="container" >
    <div class="row align-items-center mt-5" >
        <div class="col-xl-12 col-lg-12 col-md-12 col-12">
          <div class="card rounded shadow-lg border-0">
            <!-- En-tête -->
            <div class="card-header bg-primary text-white text-center py-4 rounded-top">
              <h2 class="mb-0">Dossier Juridique :{{dossier.titre}}</h2>
              <p class="mb-0">Référence : <strong>{{dossier.reference}}</strong></p>
            </div>
      
            <!-- Détails du dossier -->
            <div class="card-body">
              <!-- <h4 class="mb-3"><i class="fas fa-info-circle"></i> Informations du Dossier</h4> -->
            <!-- Bouton ou élément pour ouvrir le modal -->
<h4 class="mb-3" (click)="openQRCodeModal(qrCodeModal)">
  <i class="fas fa-info-circle"></i>  Code Qr  
    
    

</h4>


    <ul class="list-group list-group-flush">
      
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong> Description</strong> <span> {{dossier.description}}</span>
                  
                </li>
               
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Client :</strong> <span>{{dossier.client.firstname}}&nbsp;{{dossier.client.lastname}}<br> {{dossier.client.email}} </span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Type d'affaire :</strong> <span>{{dossier.type}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Categorie :</strong> 
                  <span >{{dossier.categorie}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Priorite:</strong> 
                  <span >{{dossier.priorite}}</span>
                </li>
                
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Statut :</strong> 
                  <span class="badge bg-warning text-dark">{{dossier.statut}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Date de création :</strong> <span>{{dossier.dateCreation}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Dernière mise à jour :</strong> <span>10 Mars 2024</span>
                </li>
              </ul>
            </div>
      
            <!-- Pied de page -->
            <div class="card-footer d-flex justify-content-between">
              <a (click)="openUpdateDossierModal(dossier)" class="btn btn-outline-primary">
                <i class="fas fa-edit"></i> Modifier
              
              </a>
              <ul class="nav">
                <li class="nav-item">
                  <!-- <button type="button" class="btn btn-success">Ajouter une mise à jour</button> -->

                  <a  (click)="openAddModal() " class="btn btn-outline-secondary" ><i class="fas fa-solid fa-plus"></i>  Mettre à jour le dossier</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
    <!-- page content -->
    <div class="py-6">
      <div class="row">
        <div class="offset-lg-1 col-lg-10 col-md-12 col-12">
          <!-- row -->
          <div class="row align-items-center mb-6">
           
            
            <div class="col-lg-6 col-md-12 col-12 d-flex justify-content-end">
              <!-- form -->
            <!-- <div> -->
              <!-- <a href="#!" class="btn btn-ghost btn-icon btn-sm rounded-circle texttooltip" data-template="filterOne"> -->
                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-filter icon-xs"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg> -->
                <!-- <div class="d-none" id="filterOne"> -->
                  <!-- <span>Filter</span> -->
                <!-- </div> -->
              <!-- </a> -->
             
           

    
          </div>
        </div>
          <!-- hr -->
         <!-- Message de succès -->
<div *ngIf="successMessage" class="alert alert-success position-fixed start-0 top-50 translate-middle-y ms-3" style="z-index: 1050;">
  {{ successMessage }}
  <button type="button" class="close" (click)="successMessage = ''">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<!-- Message d'erreur -->
<div *ngIf="errorMessage" class="alert alert-danger position-fixed start-0 top-50 translate-middle-y ms-3" style="z-index: 1050;">
  {{ errorMessage }}
  <button type="button" class="close" (click)="errorMessage = ''">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

 
          <div *ngIf="updates && updates.length > 0; else noUpdates">
            <div *ngFor="let update of updates" class="card bg-gray-300 shadow-none mb-4">
              
            <!-- card -->
            <div class="card bg-gray-300 shadow-none mb-4">
              <!-- card body -->
              <div class="card-body">
                <div class="d-flex justify-content-between
                  align-items-center">
                  <div>
                    <h5 class="mb-0">{{update.dateCreation|
                   date: 'mediumDate' }}</h5>
                  </div>
                  <div>
                   <a (click)="openUpdateModall(update)"><i class="fa-solid fa-pen-to-square"></i></a> 
                   &nbsp;


                    <a (click)="openDeleteConfirmationModal(deleteModal, update.id)" class="text-muted"><i class="fa-solid fa-trash"></i></a>
                  </div>
                </div>
              </div>
            </div>
            <!-- card -->
            <div class="card">
              <!-- list group -->
              <ul class="list-group list-group-flush">
                <!-- list group item -->
                <li class="list-group-item p-3">
                  <div class="d-flex justify-content-between
                    align-items-center">
                    <div class="d-flex align-items-center">
                            <!-- img -->
                    <div>
              <i class="fas fa-file-alt me-3"></i> <!-- Icône pour l'évaluation -->
            </div>
                            <!-- content -->
                      <div class="ms-3">
                        <p class="mb-0
                          font-weight-medium"><a href="#!">
                            &nbsp; evaluation</a> {{update.
evaluation}}
                            <!-- <a href="#!">Front End -->
                            <!-- Developer Team</a> -->
                        </p>
                      </div>
                    </div>
                    <div>
                            <!-- dropdown -->
                      <div class="dropdown dropstart">
                        <a href="#!" class="btn btn-ghost btn-icon btn-sm rounded-circle" id="dropdownactivityOne" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical icon-xs"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownactivityOne">
                          <a class="dropdown-item d-flex align-items-center" href="#!">Action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Another action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Something else
                            here</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                      <!-- list group item -->
                <li class="list-group-item p-3">
                  <div class="d-flex justify-content-between
                    align-items-center">
                    <div class="d-flex align-items-center">
                            <!-- avatar -->
                      <!-- Icône de note -->
            <div>
                <i class="fas fa-sticky-note me-3 text-muted"></i> <!-- Icône pour la note -->
              </div>
                            <!-- content -->
                      <div class="ms-3">
                        <p class="mb-0 font-weight-medium
                          text-dark"> &nbsp;note
                          : {{update.note}}
                         </p>
                      </div>
                    </div>
                    <div>
                            <!-- dropdown -->
                      <div class="dropdown dropstart">
                        <a href="#!" class="btn btn-ghost btn-icon btn-sm rounded-circle" id="dropdownactivityTwo" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical icon-xs"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownactivityTwo">
                          <a class="dropdown-item d-flex align-items-center" href="#!">Action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Another action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Something else
                            here</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                      <!-- list group item -->
                <li class="list-group-item p-3" *ngIf="update?.rendezVous?.dateHeure">
                  <div class="d-flex justify-content-between
                    align-items-center">
                    <div class="d-flex align-items-center" >
                            <!-- avatar -->
                            <div>
                                <i class="fas fa-calendar-alt me-3 text-muted"></i> <!-- Icône pour le rendez-vous -->
                              </div>
                            <!-- content -->
                      <div class="ms-3" >
                        <p class="mb-0
                          font-weight-medium"> &nbsp;rendezVous: {{update.dateCreation|
                   date: 'mediumDate' }} a  dateHeure 

                          motif : {{update.rendezVous.motif}}


                        </p>
                      </div>
                    </div>
                    <div>
                            <!-- dropdown -->
                      <div class="dropdown dropstart">
                        <a href="#!" class="btn btn-ghost btn-icon btn-sm rounded-circle" id="dropdownactivityThree" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical icon-xs"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownactivityThree">
                          <a class="dropdown-item d-flex align-items-center" href="#!">Action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Another action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Something else
                            here</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                      <!-- list group item -->
                <li class="list-group-item p-3">
                  <div class="d-flex justify-content-between
                    align-items-center">
                    <div class="d-flex align-items-center">
                            <!-- avatar -->
                            <div>
                                <i class="fas fa-file-download me-3 text-muted"></i> <!-- Icône pour la demande de documents -->
                              </div>
                            <!-- content -->
                      <div class="ms-3">
                        <p class="mb-0
                          font-weight-medium">
                          &nbsp; demandeDocuments :{{update.demandeDocuments}}
                         
                        </p>
                      </div>
                    </div>
                    <div>
                            <!-- dropdown -->
                      <div class="dropdown dropstart">
                        <a href="#!" class="btn btn-ghost btn-icon btn-sm rounded-circle" id="dropdownactivityFour" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical icon-xs"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownactivityFour">
                          <a class="dropdown-item d-flex align-items-center" href="#!">Action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Another action</a>
                          <a class="dropdown-item d-flex align-items-center" href="#!">Something else
                            here</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                      
             
              </ul>
            </div>
          </div>
          
      </div>
    </div>
  </div>

<!-- Template à afficher si aucune donnée n'est présente -->
<ng-template #noUpdates>
  <div class="text-center mt-4">
    <img src="assets/img/3024051.jpg" alt="Pas de mises à jour" width="250" height="200">
    <p class="mt-2 text-muted">Aucune mise à jour disponible.</p>
  </div>
</ng-template

><!-- Modal pour afficher le QR Code -->




<ng-template #qrCodeModal let-modal style="z-index: 0;">
  <div style="z-index: 0;" class="custom-modal" > <!-- Appliquer la classe custom-modal -->
    <div class="modal-header">
      <h5 class="modal-title" id="qrCodeModalLabel">QR Code du Dossier</h5>
      <button type="button" class="close" (click)="closeModal(modal)">&times;</button>
    </div>
    <div class="modal-body">
      <div *ngIf="qrCodeImageUrl">
        <center><img [src]="qrCodeImageUrl" alt="QR Code" class="img-fluid"></center>   
      </div>
      <div *ngIf="!qrCodeImageUrl">
        <p>Le QR Code est en cours de génération...</p>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="printQRCode()">Imprimer QR Code</button>
      <button type="button" class="btn btn-secondary" (click)="closeModal(modal)">Fermer</button>
    </div>
  </div>
</ng-template>



<div *ngIf="isAddModalOpen " class="overlay" (click)="closeModal()"></div>
<div *ngIf="isAddModalOpen" class="modal fade show" [ngClass]="{'d-block': isAddModalOpen}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Mettre à jour un Dossier</h5>
        <button type="button" class="close" (click)="closeAddModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="CreateUpdateDossier()" #dossierForm="ngForm">
          <!-- Évaluation -->
          <div class="form-group">
            <label>Évaluation :</label>
            <input type="text" class="form-control" [(ngModel)]="dossierUpdate.evaluation" name="evaluation" required />
          </div>
          
          <!-- Demande de Documents -->
          <div class="form-group">
            <label>Demande de Documents :</label>
            <input type="checkbox" [(ngModel)]="dossierUpdate.demandeDocuments" name="demandeDocuments" />
          </div>
          
          <!-- Rendez-vous -->
          <div class="form-group">
            <label>Date de Rendez-vous :</label>
            <input type="datetime-local" class="form-control" [(ngModel)]="dossierUpdate.rendezVous.dateHeure" name="dateHeure" />
          </div>
          <div class="form-group">
            <label>Motif du Rendez-vous :</label>
            <input type="text" class="form-control" [(ngModel)]="dossierUpdate.rendezVous.motif" name="motif" />
          </div>

          <!-- Note -->
          <div class="form-group">
            <label>Note :</label>
            <textarea class="form-control" [(ngModel)]="dossierUpdate.note" name="note"></textarea>
          </div>

          <!-- Date de création (affichage seulement) -->
          <div class="form-group">
            <label>Date de Création :</label>
            <input type="text" class="form-control" [value]="dossierUpdate.dateCreation" disabled />
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" [disabled]="!dossierForm.form.valid">Mettre à jour Dossier</button>
            <button type="button" class="btn btn-secondary" (click)="closeModall()">Annuler</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Overlay pour l'effet de fond foncé -->
<div *ngIf="isUpdateModalOpen " class="overlay" (click)="closeUpdateModal()"></div>

<!-- Modal Update -->
<div *ngIf="isUpdateModalOpen" class="modal fade show" [ngClass]="{'d-block': isUpdateModalOpen}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Mettre à jour un Dossier</h5>
        <button type="button" class="close" (click)="closeUpdateModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateUpdate()" #updateForm="ngForm">
          <!-- Évaluation -->
          <div class="form-group">
            <label>Évaluation :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedUpdate.evaluation" name="evaluation" required />
          </div>
          
          <!-- Demande de Documents -->
          <div class="form-group">
            <label>Demande de Documents :</label>
            <input type="checkbox" [(ngModel)]="selectedUpdate.demandeDocuments" name="demandeDocuments" />
          </div>
          
          <!-- Rendez-vous -->
          <div class="form-group">
            <label>Date de Rendez-vous :</label>
            <input type="datetime-local" class="form-control" [(ngModel)]="selectedUpdate.rendezVous.dateHeure" name="dateHeure" />
          </div>
          <div class="form-group">
            <label>Motif du Rendez-vous :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedUpdate.rendezVous.motif" name="motif" />
          </div>

          <!-- Note -->
          <div class="form-group">
            <label>Note :</label>
            <textarea class="form-control" [(ngModel)]="selectedUpdate.note" name="note"></textarea>
          </div>

          <!-- Date de création (affichage seulement) -->
          <div class="form-group">
            <label>Date de Création :</label>
            <input type="text" class="form-control" [value]="selectedUpdate.dateCreation" disabled />
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" [disabled]="!updateForm.form.valid">Mettre à jour</button>
            <button type="button" class="btn btn-secondary" (click)="closeUpdateModal()">Annuler</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal de mise à jour -->
<!-- Modal de mise à jour -->
<div *ngIf="modalVisible" class="modal fade show d-block">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modifier le Dossier Juridique</h5>
        <button type="button" class="close" (click)="closeModale()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateDossier()">
          <div class="form-group">
            <label>Référence :</label>
            <input disabled type="text" class="form-control" [(ngModel)]="selectedDossier.reference" name="reference" required />
          </div>
          <div class="form-group">
            <label>Titre :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedDossier.titre" name="titre" required />
          </div>
          <div class="form-group">
            <label for="description">Description :</label>
            <textarea class="form-control" [(ngModel)]="selectedDossier.description" name="description" required></textarea>
          </div>
          <div class="form-group">
            <label>Type :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedDossier.type" name="type" required />
          </div>
          <div class="form-group">
            <label for="statut">Statut :</label>
            <select class="form-control" [(ngModel)]="selectedDossier.statut" name="statut" required>
              <option value="En cours">En cours</option>
              <option value="Clôturé">Clôturé</option>
            </select>
          </div>
          <div class="form-group">
            <label for="priorite">Priorité :</label>
            <select class="form-control" [(ngModel)]="selectedDossier.priorite" name="priorite" required>
              <option value="Haute">Haute</option>
              <option value="Moyenne">Moyenne</option>
              <option value="Basse">Basse</option>
            </select>
          </div>
          <div class="form-group">
            <label>Catégorie :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedDossier.categorie" name="categorie" required />
          </div>
          <div class="form-group" hidden>
            <label>ID du Cabinet :</label>
            <input type="number" class="form-control" [(ngModel)]="selectedDossier.cabinet.id" name="cabinetId" required />
          </div>
          <div class="form-group" hidden>
            <label>ID de l'Avocat :</label>
            <input type="number" class="form-control" [(ngModel)]="selectedDossier.avocat.id" name="avocatId" required />
          </div>
          <div class="form-group">
            <label>Email du Client :</label>
            <input type="email" class="form-control" [(ngModel)]="selectedDossier.emailClient" name="clientEmail" />
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Modifier Dossier</button>
            <button type="button" class="btn btn-secondary" (click)="closeModale()">Annuler</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<ng-template #deleteModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Confirmation de suppression</h4>
    <button type="button" class="close" (click)="modal.dismiss('cross click')">&times;</button>
  </div>
  <div class="modal-body">
    <p>Êtes-vous sûr de vouloir supprimer cette mise à jour ? Cette action est irréversible.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss('cancel')">Annuler</button>
    <button type="button" class="btn btn-danger" (click)="deleteUpdate(modal.componentInstance.updateId); modal.close()">Confirmer la suppression</button>
  </div>
</ng-template>
<div class="container mt-5">
  <h2 class="text-center mb-4">Gestion des Managers</h2>

  <!-- Bouton pour ouvrir la modale d'ajout -->
  <button class="btn btn-primary mb-4" (click)="openAddModal()">
    <i class="fas fa-plus"></i> Ajouter un Manager
  </button>

  <!-- Tableau des managers -->
  <table class="table table-striped table-hover">
    <thead class="thead-dark">
      <tr>
        <th>ID</th>
        <th>Nom complet</th>
        <th>Email</th>
        <th>Cabinet</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      
      <ng-container *ngFor="let manager of managers">
        <tr *ngIf="manager.role === 'MANAGER'">
          <td>{{ manager.id }}</td>
          <td>{{ manager.firstname }} {{ manager.lastname }}</td>
          <td>{{ manager.email }}</td>
          <td>
            <strong>Nom :</strong> {{ manager.cabinet?.nom }}<br />
            <strong>Adresse :</strong> {{ manager.cabinet?.adresse }}<br />
            <strong>Téléphone :</strong> {{ manager.cabinet?.numTel }}
          </td>
          <td>
            <button class="btn btn-warning btn-sm mr-2" (click)="openUpdateModal(manager)">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <!-- <button class="btn btn-danger btn-sm" (click)="openDeleteModal(manager.id)"> -->
              
              <!-- <i class="fas fa-trash"></i> Supprimer -->
            <!-- </button> -->
            <button class="btn btn-secondary btn-sm" (click)="openArchiveModal(manager.id)">
              <i class="fas fa-archive"></i> Archiver
            </button>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>

<!-- Modale pour Ajouter un Manager -->
<div *ngIf="isAddModalOpen" class="modal fade show" [ngClass]="{'d-block': isAddModalOpen}">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ajouter un Manager</h5>
        <button type="button" class="close" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addManager()">
          <div class="form-group">
            <label>Prénom :</label>
            <input type="text" class="form-control" [(ngModel)]="newManager.firstname" name="firstname" required />
          </div>
          <div class="form-group">
            <label>Nom :</label>
            <input type="text" class="form-control" [(ngModel)]="newManager.lastname" name="lastname" required />
          </div>
          <div class="form-group">
            <label>Email :</label>
            <input type="email" class="form-control" [(ngModel)]="newManager.email" name="email" required />
          </div>
          <div class="form-group">
            <label>Mot de passe :</label>
            <input type="password" class="form-control" [(ngModel)]="newManager.password" name="password" required />
          </div>
          <h4>Informations du Cabinet</h4>
          <div class="form-group">
            <label>Nom :</label>
            <input type="text" class="form-control" [(ngModel)]="newManager.cabinet.nom" name="cabinetNom" required />
          </div>
          <div class="form-group">
            <label>Adresse :</label>
            <input type="text" class="form-control" [(ngModel)]="newManager.cabinet.adresse" name="cabinetAdresse" required />
          </div>
          <div class="form-group">
            <label>Téléphone :</label>
            <input type="text" class="form-control" [(ngModel)]="newManager.cabinet.numTel" name="cabinetNumTel" required />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Fermer</button>
            <button type="submit" class="btn btn-primary">Ajouter</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modale pour Modifier un Manager -->
<div *ngIf="isUpdateModalOpen" class="modal fade show" [ngClass]="{'d-block': isUpdateModalOpen}">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modifier un Manager</h5>
        <button type="button" class="close" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateManager()">
          <div class="form-group">
            <label>Prénom :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedManager.firstname" name="firstname" required />
          </div>
          <div class="form-group">
            <label>Nom :</label>
            <input type="text" class="form-control" [(ngModel)]="selectedManager.lastname" name="lastname" required />
          </div>
          <div class="form-group">
            <label>Email :</label>
            <input type="email" class="form-control" [(ngModel)]="selectedManager.email" name="email" required />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Fermer</button>
            <button type="submit" class="btn btn-warning">Mettre à jour</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modale pour Supprimer un Manager -->
<div *ngIf="isDeleteModalOpen" class="modal fade show" [ngClass]="{'d-block': isDeleteModalOpen}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Supprimer un Manager</h5>
        <button type="button" class="close" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Êtes-vous sûr de vouloir supprimer ce manager ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Annuler</button>
        <button type="button" class="btn btn-danger" (click)="deleteManager()">Supprimer</button>
      </div>
    </div>
  </div>
</div>
<!-- Modale pour Archiver un Manager -->
<div *ngIf="isArchiveModalOpen" class="modal fade show" [ngClass]="{'d-block': isArchiveModalOpen}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-secondary text-white">
        <h5 class="modal-title">
          <i class="fas fa-archive mr-2"></i> Archiver un Manager
        </h5>
        <button type="button" class="close text-white" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Êtes-vous sûr de vouloir archiver ce manager ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          <i class="fas fa-times mr-2"></i> Annuler
        </button>
        <button type="button" class="btn btn-warning" (click)="confirmArchive()">
          <i class="fas fa-archive mr-2"></i> Archiver
        </button>
      </div>
    </div>
  </div>
</div>
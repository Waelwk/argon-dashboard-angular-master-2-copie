<div class="container mt-5">
  <h2 class="text-center mb-4">Gestion des Managers</h2>

  <!-- Bouton pour ouvrir la modale d'ajout -->
  <button class="btn btn-primary mb-4" (click)="openAddModal()">
    <i class="fas fa-plus"></i> Ajouter un Manager
  </button>

  <!-- Tableau des managers -->
  <table class="table table-striped table-hover">
    <thead class="thead-dark">
      <tr>
        <th>ID</th>
        <th>Nom complet</th>
        <th>Email</th>
        <th>Cabinet</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let manager of managers">
        <tr *ngIf="manager.role === 'MANAGER'">
          <td>{{ manager.id }}</td>
          <td>{{ manager.firstname }} {{ manager.lastname }}</td>
          <td>{{ manager.email }}</td>
          <td>
            <strong>Nom :</strong> {{ manager.cabinet?.nom }}<br />
            <strong>Adresse :</strong> {{ manager.cabinet?.adresse }}<br />
            <strong>Téléphone :</strong> {{ manager.cabinet?.numTel }}
          </td>
          <td>
            <button class="btn btn-warning btn-sm mr-2" (click)="openUpdateModal(manager)">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <button class="btn btn-danger btn-sm" (click)="openDeleteModal(manager.id)">
              <i class="fas fa-trash"></i> Supprimer
            </button>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>

<!-- Modale pour Ajouter un Manager -->
<div *ngIf="isAddModalOpen" class="modal fade show" [ngClass]="{'d-block': isAddModalOpen}">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="fas fa-user-plus mr-2"></i> Ajouter un Manager
        </h5>
        <button type="button" class="close text-white" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addManager()" #addManagerForm="ngForm">
          <!-- Prénom -->
          <div class="form-group">
            <label for="firstname">Prénom :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="newManager.firstname"
              id="firstname"
              name="firstname"
              required
              #firstname="ngModel"
            />
            <div *ngIf="firstname.invalid && (firstname.dirty || firstname.touched)" class="text-danger">
              Le prénom est requis.
            </div>
          </div>

          <!-- Nom -->
          <div class="form-group">
            <label for="lastname">Nom :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="newManager.lastname"
              id="lastname"
              name="lastname"
              required
              #lastname="ngModel"
            />
            <div *ngIf="lastname.invalid && (lastname.dirty || lastname.touched)" class="text-danger">
              Le nom est requis.
            </div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="email">Email :</label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="newManager.email"
              id="email"
              name="email"
              required
              pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
              #email="ngModel"
            />
            <div *ngIf="email.invalid && (email.dirty || email.touched)" class="text-danger">
              Veuillez entrer un email valide.
            </div>
          </div>

          <!-- Mot de passe -->
          <div class="form-group">
            <label for="password">Mot de passe :</label>
            <input
              type="password"
              class="form-control"
              [(ngModel)]="newManager.password"
              id="password"
              name="password"
              required
              minlength="6"
              #password="ngModel"
            />
            <div *ngIf="password.invalid && (password.dirty || password.touched)" class="text-danger">
              Le mot de passe doit contenir au moins 6 caractères.
            </div>
          </div>

          <!-- Informations du Cabinet -->
          <h4 class="mt-4">
            <i class="fas fa-building mr-2"></i> Informations du Cabinet
          </h4>

          <!-- Nom du Cabinet -->
          <div class="form-group">
            <label for="cabinetNom">Nom :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="newManager.cabinet.nom"
              id="cabinetNom"
              name="cabinetNom"
              required
              #cabinetNom="ngModel"
            />
            <div *ngIf="cabinetNom.invalid && (cabinetNom.dirty || cabinetNom.touched)" class="text-danger">
              Le nom du cabinet est requis.
            </div>
          </div>

          <!-- Adresse du Cabinet -->
          <div class="form-group">
            <label for="cabinetAdresse">Adresse :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="newManager.cabinet.adresse"
              id="cabinetAdresse"
              name="cabinetAdresse"
              required
              #cabinetAdresse="ngModel"
            />
            <div *ngIf="cabinetAdresse.invalid && (cabinetAdresse.dirty || cabinetAdresse.touched)" class="text-danger">
              L'adresse du cabinet est requise.
            </div>
          </div>

          <!-- Téléphone du Cabinet -->
          <div class="form-group">
            <label for="cabinetNumTel">Téléphone :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="newManager.cabinet.numTel"
              id="cabinetNumTel"
              name="cabinetNumTel"
              required
              #cabinetNumTel="ngModel"
            />
            <div *ngIf="cabinetNumTel.invalid && (cabinetNumTel.dirty || cabinetNumTel.touched)" class="text-danger">
              Le numéro de téléphone est requis.
            </div>
          </div>

          <!-- Boutons du formulaire -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              <i class="fas fa-times mr-2"></i> Fermer
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="addManagerForm.invalid">
              <i class="fas fa-save mr-2"></i> Ajouter
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modale pour Modifier un Manager -->
<div *ngIf="isUpdateModalOpen" class="modal fade show" [ngClass]="{'d-block': isUpdateModalOpen}">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-warning text-white">
        <h5 class="modal-title">
          <i class="fas fa-edit mr-2"></i> Modifier un Manager
        </h5>
        <button type="button" class="close text-white" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateManager()" #updateManagerForm="ngForm">
          <!-- Prénom -->
          <div class="form-group">
            <label for="firstname">Prénom :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="selectedManager.firstname"
              id="firstname"
              name="firstname"
              required
              #firstname="ngModel"
            />
            <div *ngIf="firstname.invalid && (firstname.dirty || firstname.touched)" class="text-danger">
              Le prénom est requis.
            </div>
          </div>

          <!-- Nom -->
          <div class="form-group">
            <label for="lastname">Nom :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="selectedManager.lastname"
              id="lastname"
              name="lastname"
              required
              #lastname="ngModel"
            />
            <div *ngIf="lastname.invalid && (lastname.dirty || lastname.touched)" class="text-danger">
              Le nom est requis.
            </div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="email">Email :</label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="selectedManager.email"
              id="email"
              name="email"
              required
              pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
              #email="ngModel"
            />
            <div *ngIf="email.invalid && (email.dirty || email.touched)" class="text-danger">
              Veuillez entrer un email valide.
            </div>
          </div>

          <!-- Mot de passe -->
          <div class="form-group">
            <label for="password">Mot de passe :</label>
            <input
              type="password"
              class="form-control"
              [(ngModel)]="selectedManager.password"
              id="password"
              name="password"
              minlength="6"
              #password="ngModel"
            />
            <div *ngIf="password.invalid && (password.dirty || password.touched)" class="text-danger">
              Le mot de passe doit contenir au moins 6 caractères.
            </div>
          </div>

          <!-- Boutons du formulaire -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              <i class="fas fa-times mr-2"></i> Fermer
            </button>
            <button type="submit" class="btn btn-warning" [disabled]="updateManagerForm.invalid">
              <i class="fas fa-save mr-2"></i> Mettre à jour
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modale pour Supprimer un Manager -->
<div *ngIf="isDeleteModalOpen" class="modal fade show" [ngClass]="{'d-block': isDeleteModalOpen}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="fas fa-trash mr-2"></i> Supprimer un Manager
        </h5>
        <button type="button" class="close text-white" (click)="closeModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Êtes-vous sûr de vouloir supprimer ce manager ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          <i class="fas fa-times mr-2"></i> Annuler
        </button>
        <button type="button" class="btn btn-danger" (click)="deleteManager()">
          <i class="fas fa-trash mr-2"></i> Supprimer
        </button>
      </div>
    </div>
  </div>
</div>